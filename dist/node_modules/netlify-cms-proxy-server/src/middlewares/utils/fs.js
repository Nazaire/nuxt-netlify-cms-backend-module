"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = __importDefault(require("path"));
const fs_1 = require("fs");
const listFiles = async (dir, extension, depth) => {
    if (depth <= 0) {
        return [];
    }
    try {
        const dirents = await fs_1.promises.readdir(dir, { withFileTypes: true });
        const files = await Promise.all(dirents.map(dirent => {
            const res = path_1.default.join(dir, dirent.name);
            return dirent.isDirectory()
                ? listFiles(res, extension, depth - 1)
                : [res].filter(f => f.endsWith(extension));
        }));
        return [].concat(...files);
    }
    catch (e) {
        return [];
    }
};
exports.listRepoFiles = async (repoPath, folder, extension, depth) => {
    const files = await listFiles(path_1.default.join(repoPath, folder), extension, depth);
    return files.map(f => f.substr(repoPath.length + 1));
};
exports.writeFile = async (filePath, content) => {
    await fs_1.promises.mkdir(path_1.default.dirname(filePath), { recursive: true });
    await fs_1.promises.writeFile(filePath, content);
};
exports.deleteFile = async (repoPath, filePath) => {
    await fs_1.promises.unlink(path_1.default.join(repoPath, filePath));
};
